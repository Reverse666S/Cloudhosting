<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SkyCortex Cloud - Dashboard</title>
<link rel="icon" href="/static/pepecraft.png" type="image/png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background-color:#000; color:#fff; font-family:'Roboto',sans-serif; margin:0; padding:0; }
.card { background-color:#0d0d0d; border:1px solid #00ff00; border-radius:10px; margin-bottom:1rem; padding:1rem; }
input, select { background-color:#003300; color:#fff; border:1px solid #00ff00; border-radius:5px; padding:0.5rem; width:100%; margin-bottom:0.5rem; }
a { color:#00ff00; text-decoration:none; }
a:hover { color:#66ff66; }
.btn-success { background-color:#00ff00; color:#000; border:none; width:100%; margin-top:0.5rem; }
.btn-success:hover { background-color:#66ff66; }
.btn-danger { background-color:#ff0000; color:#000; border:none; }
.btn-danger:hover { background-color:#ff6666; }
.progress { height:15px; border-radius:5px; margin-top:0.5rem; }
footer { text-align:center; margin-top:2rem; }
#storageWarning { color:#ff4444; text-align:center; display:none; margin-top:0.5rem; }
.list-group-item { background-color:#0a0a0a; border:1px solid #00ff00; margin-bottom:2px; border-radius:5px; }
</style>
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-6">
            <!-- Upload -->
            <div class="card">
                <h3 class="text-center mb-2">Datei hochladen</h3>
                <form id="uploadForm" method="post" enctype="multipart/form-data">
                    <input type="file" name="file" required>
                    <button type="submit" class="btn-success">Hochladen</button>
                </form>
                <div class="progress" id="progressContainer" style="display:none;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width:0%">0%</div>
                </div>
                <div id="storageWarning">Maximaler Speicher erreicht!</div>
            </div>

            <!-- Eigene Dateien -->
            <div class="card">
                <h4 class="mb-2">Meine Dateien</h4>
                <ul class="list-group list-group-flush" id="fileList"></ul>
            </div>

            <form method="post" action="/logout">
                <button class="btn-success mt-2">Logout</button>
            </form>
        </div>
    </div>
</div>

<footer>
    <span>Powered by Danger222</span><br>
    <img src="/static/pepecraft.png" alt="Logo" style="height:50px;">
</footer>

<script>
// Upload
document.getElementById("uploadForm").addEventListener("submit", function(e){
    e.preventDefault();
    const file = e.target.querySelector('input[type="file"]').files[0];
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = progressContainer.querySelector(".progress-bar");
    const storageWarning = document.getElementById("storageWarning");

    fetch("/check_storage?file_size="+file.size)
        .then(r=>r.json())
        .then(data=>{
            if(data.too_large){ storageWarning.style.display="block"; return; }
            storageWarning.style.display="none";
            progressContainer.style.display="block";
            progressBar.style.width="0%";
            progressBar.textContent="0%";

            const formData = new FormData(e.target);
            const xhr = new XMLHttpRequest();
            xhr.upload.addEventListener("progress", event=>{
                if(event.lengthComputable){
                    let percent = Math.round((event.loaded/event.total)*100);
                    progressBar.style.width = percent+"%";
                    progressBar.textContent = percent+"%";
                }
            });
            xhr.addEventListener("load", ()=>{
                if(xhr.status===200){ progressBar.classList.add("bg-success"); progressBar.textContent="Fertig!"; loadFiles(); }
                else { progressBar.classList.add("bg-danger"); progressBar.textContent="Fehler!"; }
            });
            xhr.open("POST","/upload");
            xhr.send(formData);
        });
});

// Dateiliste laden
function loadFiles(){
    fetch("/user_files")
        .then(r=>r.json())
        .then(data=>{
            const fileList = document.getElementById("fileList");
            fileList.innerHTML = "";
            data.files.forEach(file=>{
                const li = document.createElement("li");
                li.className="list-group-item d-flex justify-content-between align-items-center";
                li.innerHTML = `<span>${file}</span>
                    <div>
                        <a href="/download/${file}" class="btn btn-success btn-sm me-1">Download</a>
                        <form method="post" action="/delete/${file}" style="display:inline;">
                            <button class="btn btn-danger btn-sm">LÃ¶schen</button>
                        </form>
                    </div>`;
                fileList.appendChild(li);
            });
        });
}

loadFiles();
setInterval(loadFiles, 10000);
</script>
</body>
</html>
